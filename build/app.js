(()=>{"use strict";const e=new class{async save(e){return chrome.storage.sync.set({[e]:Date().toString()})}async exists(e){return chrome.storage.sync.get(e).then((e=>Object.keys(e).length>0))}async get(e){return chrome.storage.sync.get(e).then((e=>Object.keys(e).length>0?e:null))}async getAll(){return chrome.storage.sync.get().then((e=>Object.keys(e).reverse()))}async delete(e){return chrome.storage.sync.remove(e)}async deleteAll(){return chrome.storage.sync.clear()}},t=new class{currentURL="";routes=new Map;constructor(){this.setObserver()}setObserver(){new MutationObserver(this.eventObserver.bind(this)).observe(document.querySelector("title"),{subtree:!0,childList:!0})}eventObserver(){if(this.currentURL==window.location.href)return!1;this.runRoutes()}add(e,t){this.routes.set(e,t)}runRoutes(){this.currentURL=window.location.href;const e=new URL(this.currentURL),t=e.pathname+e.search;return this.routes.forEach(((e,r)=>!!t.startsWith(r)&&(e.run(),!0))),!1}},r=new class{saveButtonHTML='<pickering-yt-save>\n    <button>\n        <div class="icon">\n            <svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n                width="112.000000pt" height="112.000000pt" viewBox="0 0 112.000000 112.000000"\n                preserveAspectRatio="xMidYMid meet">\n                <g transform="translate(0.000000,112.000000) scale(0.100000,-0.100000)"\n                fill="#000000" stroke="none">\n                <path d="M657 982 c-32 -33 -33 -39 -8 -66 20 -21 20 -21 -61 -86 -44 -36\n                -106 -86 -138 -112 -32 -27 -62 -48 -66 -48 -4 0 -22 14 -39 30 l-32 31 -33\n                -31 -33 -31 89 -90 89 -89 -143 -143 c-124 -124 -142 -146 -142 -175 0 -29 3\n                -32 32 -32 29 0 51 18 175 142 l143 143 87 -88 88 -87 33 31 34 31 -32 33 -32\n                33 62 79 c34 43 82 106 108 140 49 66 61 73 82 48 18 -22 33 -19 63 13 l27 28\n                -138 140 c-77 76 -150 149 -164 161 l-24 23 -27 -28z"/>\n                </g>\n            </svg>\n        </div>\n\n        <label for="">Save</label>\n    </button>\n</pickering-yt-save>';parentQuerySelector="ytd-reel-video-renderer[is-active] #actions";positioningQuerySelector="ytd-reel-video-renderer[is-active] #share-button";buttonTagName="pickering-yt-save";changingTargetQuerySelector="ytd-reel-video-renderer[is-active]";currentURL="";manager;constructor(e){this.manager=e}run(){if(!this.setObserver())return!1;this.currentURL=window.location.href,setTimeout((()=>{this.injectSaveButton()}),1e3)}async injectSaveButton(){const e=document.querySelector(this.positioningQuerySelector);if(!e)return!1;const t=document.querySelector(this.parentQuerySelector);if(t.querySelector(this.buttonTagName))return null;e.insertAdjacentHTML("beforebegin",this.saveButtonHTML);const r=t.querySelector(this.buttonTagName);r.querySelector(".icon").addEventListener("click",(()=>{this.eventSaveButton(r)})),await this.manager.exists(this.currentURL)&&(r.className="saved")}eventSaveButton(e){return e.classList.contains("saved")?(this.manager.delete(this.currentURL),e.classList.remove("saved"),"deleted"):(this.manager.save(this.currentURL),e.className="saved","saved")}setObserver(){const e=document.querySelector(this.changingTargetQuerySelector);return!!e&&(new MutationObserver(this.eventObserver.bind(this)).observe(e,{attributes:!0,attributeFilter:["is-active"]}),!0)}eventObserver(e,t){this.run()}}(e),n=new class{viewerHTML='\n  <pickering-yt-viewer>\n    <header>\n\n      <svg id="pickering-yt-viewer-icon" viewBox="0 0 432 468" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <rect y="156.385" width="390.656" height="174.441" rx="84" transform="rotate(-27.5 0 156.385)" fill="#F40407"/>\n        <rect x="4.20776" y="338.17" width="390.656" height="174.441" rx="84" transform="rotate(-27.5 4.20776 338.17)" fill="#F40407"/>\n        <path d="M228.818 170.377C223.816 175.536 223.66 176.474 227.568 180.694C230.694 183.977 230.694 183.977 218.032 194.138C211.154 199.766 201.462 207.582 196.46 211.646C191.457 215.867 186.768 219.149 186.143 219.149C185.517 219.149 182.703 216.961 180.046 214.46L175.044 209.614L169.885 214.46L164.726 219.306L178.639 233.375L192.552 247.287L170.198 269.641C150.814 289.025 148 292.464 148 296.998C148 301.531 148.469 302 153.002 302C157.536 302 160.975 299.186 180.359 279.802L202.713 257.448L216.313 271.205L230.069 284.805L235.228 279.959L240.543 275.113L235.54 269.954L230.538 264.795L240.23 252.446C245.545 245.724 253.048 235.876 257.113 230.561C264.772 220.244 266.648 219.149 269.931 223.057C272.745 226.497 275.09 226.028 279.779 221.025L284 216.648L262.428 194.763C250.391 182.883 238.979 171.471 236.791 169.595L233.039 166L228.818 170.377Z" fill="white"/>\n      </svg>\n\n      <h1>Saved Shorts</h1>\n\n    </header>\n    <main>\n      \n    </main>\n</pickering-yt-viewer>\n';positioningQuerySelector="#contents > ytd-playlist-video-list-renderer";emptyViewHTML='<p class="empty"> No Saved Shorts</p>';manager;constructor(e){this.manager=e}run(){setTimeout((()=>{this.injectViewer()}),1e3)}async injectViewer(){if(document.querySelector("pickering-yt-viewer")){const e=document.querySelector("pickering-yt-viewer  main");return e.innerHTML="",await this.injectShorts(e),!0}const e=document.querySelector(this.positioningQuerySelector);if(!e)return!1;e.insertAdjacentHTML("afterbegin",this.viewerHTML);const t=document.querySelector("pickering-yt-viewer");await this.injectShorts(t.querySelector("main"))}async injectShorts(e){const t=await this.manager.getAll(),r=Object.keys(t).length;if(r<1)return e.innerHTML=this.emptyViewHTML,!0;for(let n=0;n<=r;n++)await this.injectShort(e,t[n])}async injectShort(e,t){const r=await this.getOpenGraphInfo(t);if(!r)return!1;e.appendChild(this.createShortsCard(t,r.imageURL,r.title))}async getOpenGraphInfo(e){try{const t=await fetch(e),r=await t.text(),n=(new DOMParser).parseFromString(r,"text/html");return{imageURL:n.querySelector('meta[property="og:image"]').getAttribute("content"),title:n.querySelector('meta[property="og:title"]').getAttribute("content")}}catch(e){return!1}}createShortsCard(e,t,r){let n=document.createElement("a");return n.className="pickering-yt-shorts-card",n.href=e,n.innerHTML=`<button class="close">Delete</button><img src="${t}" alt=""><h2>${r}</h2>`,n.querySelector("button").addEventListener("click",(t=>{t.preventDefault(),this.eventDeleteShort(e,n)})),n}eventDeleteShort(e,t){this.manager.delete(e),t.remove()}abbrNum(e,t=1){t=Math.pow(10,t);for(var r=["k","m","b","t"],n=r.length-1;n>=0;n--){var s=Math.pow(10,3*(n+1));if(s<=e){1e3==(e=Math.round(e*t/s)/t)&&n<r.length-1&&(e=1,n++),e+=r[n];break}}return e}}(e);t.add("/shorts",r),t.add("/playlist?list=WL",n),t.runRoutes()})();